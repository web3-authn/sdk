{
	debug
}

# App (Vite dev server)
example.localhost {
	tls internal
	encode gzip
	log {
		output stdout
		format console
	}
	header {
		Cross-Origin-Embedder-Policy "require-corp"
		Cross-Origin-Opener-Policy "same-origin"
		# Allow WebAuthn in this app and delegate to wallet origin iframe
		Permissions-Policy "publickey-credentials-get=(self \"https://wallet.example.localhost\"), publickey-credentials-create=(self \"https://wallet.example.localhost\")"
	}
	reverse_proxy localhost:5173
}

# Wallet host (placeholder for dedicated wallet dev server)
wallet.example.localhost {
	tls internal
	encode gzip
	log {
		output stdout
		format console
	}
	header {
		Cross-Origin-Embedder-Policy "require-corp"
		Cross-Origin-Opener-Policy "same-origin"
		Permissions-Policy "publickey-credentials-get=(self), publickey-credentials-create=(self)"
	}
	# If you run a wallet dev server on 5174, proxy here
	reverse_proxy localhost:5174
}

# Relay server on separate origin
relay-server.localhost {
	tls internal
	encode gzip
	log {
		output stdout
		format console
	}
	reverse_proxy 127.0.0.1:3000
}
