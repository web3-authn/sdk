{"version":3,"file":"AccessKeysModal2.js","names":["AccessKeysModal: React.FC<AccessKeysModalProps>","usePasskeyContext","useTheme","err: any"],"sources":["../../../../../src/react/components/ProfileSettingsButton/AccessKeysModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePasskeyContext } from '../../context';\nimport { HaloBorder } from './HaloBorder';\nimport './AccessKeysModal.css';\nimport { AccessKeyInfoView, FunctionCallPermissionView } from '@near-js/types';\nimport { useTheme } from '../theme';\nimport PasskeyHaloLoading from './PasskeyHaloLoading';\nimport LitPasskeyHaloLoading from '../LitPasskeyHaloLoading';\n\ninterface AccessKeysModalProps {\n  nearAccountId: string;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport const AccessKeysModal: React.FC<AccessKeysModalProps> = ({\n  nearAccountId,\n  isOpen,\n  onClose\n}) => {\n  const { passkeyManager } = usePasskeyContext();\n  const { theme } = useTheme();\n  const [accessKeys, setAccessKeys] = useState<AccessKeyInfoView[]>([\n    {\n      public_key: 'placeholder',\n      access_key: {\n        nonce: 0n,\n        block_height: 0,\n        block_hash: 'placeholder',\n        permission: {\n          FunctionCall: {\n            allowance: '1000000000000000000000000',\n            receiver_id: 'placeholder',\n            method_names: ['placeholder']\n          }\n        }\n      },\n    }\n  ]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [tooltipVisible, setTooltipVisible] = useState<number | null>(null);\n  const [copiedKeys, setCopiedKeys] = useState<Set<number>>(new Set());\n\n  useEffect(() => {\n    if (isOpen) {\n      loadAccessKeys();\n    }\n  }, [isOpen]);\n\n  const loadAccessKeys = async () => {\n    if (!passkeyManager) return;\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const keys = await passkeyManager.viewAccessKeyList(nearAccountId);\n      setTimeout(() => {\n        setAccessKeys(keys.keys);\n      }, 500);\n    } catch (err: any) {\n      setError(err.message || 'Failed to load access keys');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const copyToClipboard = async (text: string, keyIndex: number) => {\n    try {\n      await navigator.clipboard.writeText(text);\n\n      // Fire custom event for copy action\n      const copyEvent = new CustomEvent('accessKeyCopied', {\n        detail: {\n          publicKey: text,\n          keyIndex: keyIndex,\n          timestamp: Date.now()\n        }\n      });\n      window.dispatchEvent(copyEvent);\n\n      // Show brief tooltip feedback\n      setTooltipVisible(keyIndex);\n      setTimeout(() => setTooltipVisible(null), 2000);\n\n      // Set copied state for status badge\n      setCopiedKeys(prev => new Set(prev).add(keyIndex));\n      setTimeout(() => {\n        setCopiedKeys(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(keyIndex);\n          return newSet;\n        });\n      }, 3000);\n    } catch (err) {\n      console.error('Failed to copy to clipboard:', err);\n    }\n  };\n\n  const getPermissionType = (permission: \"FullAccess\" | FunctionCallPermissionView) => {\n    if (permission === \"FullAccess\") return 'Full Access';\n    if (\n      'FunctionCall' in permission &&\n      'receiver_id' in permission?.FunctionCall &&\n      'method_names' in permission?.FunctionCall &&\n      permission?.FunctionCall?.method_names?.length > 0\n    ) {\n      return 'Function Call';\n    }\n    return 'Unknown';\n  };\n\n  const getPermissionDetails = (permission: any) => {\n    if (permission.FunctionCall) {\n      const { allowance, receiver_id, method_names } = permission.FunctionCall;\n      return {\n        allowance: allowance || '0',\n        receiverId: receiver_id,\n        methodNames: method_names || []\n      };\n    }\n    return null;\n  };\n\n  if (!isOpen) return null;\n\n  // Prevent any events from bubbling up to parent components\n  const handleBackdropClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onClose();\n  };\n\n  const handleModalContentClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // Don't call onClose here - we want to keep the modal open\n  };\n\n  return (\n    <div className={`w3a-access-keys-modal-backdrop theme-${theme}`}\n      onClick={handleBackdropClick}\n      onMouseDown={(e) => e.stopPropagation()}\n      onMouseUp={(e) => e.stopPropagation()}\n    >\n      <div className=\"w3a-access-keys-modal-content\"\n        onClick={handleModalContentClick}\n        onMouseDown={(e) => e.stopPropagation()}\n        onMouseUp={(e) => e.stopPropagation()}\n      >\n        <div className=\"w3a-access-keys-modal-header\">\n          <h2 className=\"w3a-access-keys-modal-title\">Access Keys</h2>\n          <button className=\"w3a-access-keys-modal-close\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              onClose();\n            }}\n          >\n            âœ•\n          </button>\n        </div>\n\n        {error && (\n          <div className=\"w3a-access-keys-error\">\n            <p>{error}</p>\n            <button onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              loadAccessKeys();\n            }} className=\"w3a-btn w3a-btn-primary\">\n              Try Again\n            </button>\n          </div>\n        )}\n\n        {!isLoading && !error && accessKeys.length === 0 && (\n          <div className=\"w3a-access-keys-empty\">\n            <p>No access keys found.</p>\n          </div>\n        )}\n\n        {!error && accessKeys.length > 0 && (\n          <div className=\"w3a-keys-list\">\n            {accessKeys.map((key, index) => {\n              const permissionType = getPermissionType(key.access_key.permission);\n              const permissionDetails = getPermissionDetails(key.access_key.permission);\n              return (\n                <div key={index} className=\"w3a-key-item\">\n                  <div className=\"w3a-key-content\">\n                    <div className=\"w3a-key-details\">\n                      <div className=\"w3a-key-header\">\n                        {\n                          key.public_key === 'placeholder' ? (\n                            <div className=\"mono w3a-copyable-key\">\n                              <span style={{ opacity: 0 }}>\n                                ........................................................\n                              </span>\n                            </div>\n                          ) : (\n                            <div\n                              className=\"mono w3a-copyable-key\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                copyToClipboard(key.public_key, index);\n                              }}\n                              onMouseEnter={() => setTooltipVisible(index)}\n                              onMouseLeave={() => setTooltipVisible(null)}\n                              title=\"Click to copy\"\n                            >\n                              {key.public_key}\n                              {tooltipVisible === index && (\n                                <div className=\"w3a-copy-tooltip\">Click to copy</div>\n                              )}\n                            </div>\n                          )\n                        }\n                      </div>\n                    </div>\n\n                    {\n                      key.public_key !== 'placeholder' &&\n                      <div className=\"w3a-key-status\">\n                        <span className={`w3a-status-badge ${copiedKeys.has(index) ? 'w3a-copied' : 'w3a-' + permissionType.toLowerCase().replace(' ', '-')}`}>\n                          {copiedKeys.has(index) ? 'Copied' : permissionType}\n                        </span>\n                      </div>\n                    }\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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"}